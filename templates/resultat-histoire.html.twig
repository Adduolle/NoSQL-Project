{% extends 'base.html.twig' %}

{% block title %}RÃ©sultat Histoire{% endblock %}
{% block body %}

        <!--barre de navegation-->
        <header class="main-header">
            <nav class="navbar navbar-expand-sm navbar-light p-4">
                <a href="index.html"><img src="{{ asset('images/TaleRoom(1).png')}}" alt="TaleRoom"></a>

                <ul class="navbar-nav ml-auto">
                    <li class="nav-items user-profile">

                        <a class="nav-link" href="/profile">
                            <span class="user-name">{{nickname}}</span> 
                        </a>
                        
                    </li>
                </ul>    
            </nav>
        </header>

        <main class="hero-content-center d-flex ">
            
            <div class="container">
                <div class="row justify-content-center h-100 ">
                    <div class=" col-md-7 col-lg-7">
                        
                        <div class="card tale-room-card shadow">
                            <div class="card-body">

                                <h1 class="title-name" id="story-title"></h1>

                                <div class="scrollable-content">
                                    <div id="stories-created"></div>
                                </div>

                                <div class="text-center mt-3">
                                    <button class="btn tale-room-btn" id="next-story">Voir suivant</button>
                                </div>

                            </div>
                        </div>

                        <script>
                            const stories = {{ stories|json_encode|raw }};
                        </script>
                        
                    </div>
                    
                </div>                

            </div>
            
        </main>

      
        
{% endblock %}

<script>
    let currentIndex = 0;

    const titleEl = document.getElementById('story-title');
    const containerEl = document.getElementById('stories-created');
    const nextBtn = document.getElementById('next-story');

    function renderStory(index) {
        const story = stories[index];

        // Titre
        titleEl.textContent = story.title;

        // Contenu
        containerEl.innerHTML = '';

        story.players.forEach((player, i) => {
            const div = document.createElement('div');
            div.className = 'story-item mb-3 p-3' + (i < story.players.length - 1 ? ' border-bottom' : '');

            div.innerHTML = `
                <h5 class="player-name">${player.name}</h5>
                <p class="story-text mb-0">${player.text}</p>
            `;

            containerEl.appendChild(div);
        });
    }
    containerEl.classList.add('fade');
    setTimeout(() => containerEl.classList.remove('fade'), 300);


    // Bouton "suivant"
    nextBtn.addEventListener('click', () => {
        currentIndex = (currentIndex + 1) % stories.length;
        renderStory(currentIndex);
    });

    // Initialisation
    renderStory(currentIndex);
</script>
